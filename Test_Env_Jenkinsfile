pipeline {

	agent any

	environment {
	DOCKER_HUB_CREDS = credentials('ericfontes-docker-hub') 
	}
		
	stages {

	  stage('Tooling versions') {

	    steps{
	      sh '''
	        docker --version
		docker compose version
		'''
		}
          }

	  stage('Build') {

	    steps {
	      sh 'docker context use default'
	      sh 'docker compose build'
	      sh 'docker compose push'
              sh 'docker compose ps'
	       }
	  }

	stage('SonarCloud'){
	withSonarQubeEnv('sonarcloud') {
    sh "./mvnw org.jacoco:jacoco-maven-plugin:prepare-agent verify \
        sonar:sonar -Dsonar.branch.name=${env.BRANCH_NAME}"
	    }
	}

     }
}
